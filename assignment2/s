#!/bin/bash

# https://github.com/javacc/javacc/archive/javacc-7.0.11.tar.gz

DIR_NAME=lp

# rm -rf $DIR_NAME
# mkdir $DIR_NAME

java -cp javacc-javacc-7.0.11/bootstrap/javacc.jar \
      jjtree \
      -OUTPUT_DIRECTORY=$DIR_NAME \
      Language.jjt

if [ $? -ne 0 ]; then
        echo "Did not successfully run jjtree"
        exit 1
fi

java -cp javacc-javacc-7.0.11/bootstrap/javacc.jar \
      org.javacc.parser.Main \
      -OUTPUT_DIRECTORY=$DIR_NAME \
      $DIR_NAME/Language.jj

if [ $? -ne 0 ]; then
        echo "Did not successfully run javacc"
        exit 2
fi

cp *Visitor.java $DIR_NAME/

( cd $DIR_NAME
  javac *.java
  java -cp . Lexer "../${1}"
  if [ $? -ne 0 ]; then
        echo "Runtime Error"
        exit 3
  fi
)

echo "SUCCESS" > OUTPUT
